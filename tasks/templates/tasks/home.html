<!DOCTYPE html>
<html>
<head>
    <title>QuickTask</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'tasks/style.css' %}">
</head>
<body>
    <div class="header-container">
        <button id="theme-toggle" class="btn theme-btn">üåô</button>
        <h1 id="page-title">MUST FINISH TODAY!</h1>
        <button id="settings-toggle" class="btn settings-btn">‚öôÔ∏è</button>
    </div>

    <div id="settings-panel" style="display:none; margin-bottom: 20px;">
        <label for="bg-color">Background Color:</label>
        <input type="color" id="bg-color" value="#d0f0fd">

        <label for="header-color">Header Color:</label>
        <input type="color" id="header-color" value="#ffb6c1">
    </div>

    <!-- Form to add a task -->
    <form method="POST">
        {% csrf_token %}
        <input type="text" name="title" placeholder="Add a task" required>
        <button type="submit">Add</button>
    </form>

    <!-- Show the task list -->
    <ul>
        {% for task in tasks %}
            <li>
                {{ task.title }}
                {% if task.complete %}(‚úì){% endif %}
                <form method="post" action="{% url 'toggle_complete' task.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn toggle-btn">Toggle</button>
                </form>

                <form method="post" action="{% url 'delete_task' task.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn delete-btn">Delete</button>
                </form>
            </li>
        {% empty %}
            <li>No tasks yet!</li>
        {% endfor %}
    </ul>
    <script>
        const settingsToggle = document.getElementById('settings-toggle');
        const settingsPanel = document.getElementById('settings-panel');
        const themeToggle = document.getElementById('theme-toggle');

        settingsToggle.addEventListener('click', () => {
            settingsPanel.style.display = settingsPanel.style.display === 'none' ? 'block' : 'none';
        });

        // Load saved background color, header color, and dark mode on page load
        const bgColorInput = document.getElementById('bg-color');
        const headerColorInput = document.getElementById('header-color');
        const pageTitle = document.getElementById('page-title');

         // Define your preferred colors for dark and light mode
        const DARK_BG = '#222831';
        const DARK_HEADER = '#393e46';
        const LIGHT_BG = '#d0f0fd';
        const LIGHT_HEADER = '#ffb6c1';

        function setColors(bg, header) {
            document.body.style.backgroundColor = bg;
            pageTitle.style.backgroundColor = header;
            bgColorInput.value = bg;
            headerColorInput.value = header;
        }

        const savedDarkMode = localStorage.getItem('darkMode');
        const savedBgColor = localStorage.getItem('bgColor');
        const savedHeaderColor = localStorage.getItem('headerColor');
        if (savedDarkMode === 'true') {
            document.body.classList.add('dark-mode');
            themeToggle.textContent = 'üåû';
            setColors(savedBgColor || DARK_BG, savedHeaderColor || DARK_HEADER);
        } else {
            themeToggle.textContent = 'üåô';
            setColors(savedBgColor || LIGHT_BG, savedHeaderColor || LIGHT_HEADER);
        }

        // Save background color to localStorage when changed
        bgColorInput.addEventListener('input', (e) => {
            document.body.style.backgroundColor = e.target.value;
            localStorage.setItem('bgColor', e.target.value);
        });

        // Save header color to localStorage when changed
        headerColorInput.addEventListener('input', (e) => {
            pageTitle.style.backgroundColor = e.target.value;
            localStorage.setItem('headerColor', e.target.value);
        });

        // Save dark mode state and colors to localStorage when toggled
        themeToggle.addEventListener('click', () => {
            const isDark = document.body.classList.toggle('dark-mode');
            themeToggle.textContent = isDark ? 'üåû' : 'üåô';
            localStorage.setItem('darkMode', isDark);
            if (isDark) {
                setColors(DARK_BG, DARK_HEADER);
                localStorage.setItem('bgColor', DARK_BG);
                localStorage.setItem('headerColor', DARK_HEADER);
            } else {
                setColors(LIGHT_BG, LIGHT_HEADER);
                localStorage.setItem('bgColor', LIGHT_BG);
                localStorage.setItem('headerColor', LIGHT_HEADER);
            }
        });
    </script>
</body>
</html>
